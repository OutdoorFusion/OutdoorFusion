<!DOCTYPE html>
<html>
<head>
    <title>Verkoopprestaties</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Verkoopprestaties</h1>

    <select id="productSelect">
        <option value="" disabled selected>Select a product</option>
        <!-- Options will be added dynamically using JavaScript -->
    </select>

    <div id="productInfoContainer">
        <!-- Product information will be displayed here -->
    </div>

    <div id="chartContainer">
        <!-- Chart will be displayed here -->
    </div>

    <script>
        $(document).ready(function() {
            // Make an AJAX request to retrieve the product options
            $.getJSON('/tablesVerkoopPrestaties', function(data) {
                var productOptions = data.tablesVerkoopPrestatie;

                // Update the select element with product options
                var select = $('#productSelect');
                $.each(productOptions, function(index, option) {
                    select.append($('<option></option>').attr('value', option).text(option));
                });
            });

            // Handle select change event
            $('#productSelect').on('change', function() {
                var selectedProduct = $(this).val();

                // Make an AJAX request to retrieve product information
                $.getJSON('/product_data', { product: selectedProduct }, function(response) {
                    var productInfo = response.productInfo;

                    // Update the product information container
                    $('#productInfoContainer').html(`
                        <h2>${selectedProduct}</h2>
                        <p>Unit Cost: ${productInfo.unitCost}</p>
                        <p>Unit Price: ${productInfo.unitPrice}</p>
                        <p>Profit: ${productInfo.profit}</p>
                        <p>Quantity: ${productInfo.quantity}</p>
                        <p>Revenue: ${productInfo.revenue}</p>
                    `);

                    // Make an AJAX request to retrieve the bar chart data
                    $.getJSON('/chartVerkoopPrestaties', { type: 'bar', field_a: 'month', field_b: 'difference' }, function(chartData) {
                        var chartJSON = chartData;

                        // Prepare the data for the bar chart
                        var data = [{
                            x: chartJSON.months,
                            y: chartJSON.differences,
                            type: 'bar'
                        }];

                        // Set the layout for the bar chart
                        var layout = {
                            title: 'Product Data Difference by Month',
                            xaxis: {
                                title: 'Month'
                            },
                            yaxis: {
                                title: 'Difference'
                            }
                        };

                        // Render the bar chart using Plotly
                        Plotly.newPlot('chartContainer', data, layout);
                    });
                });
            });
        });
    </script>
</body>
</html>
